<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon Explorer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
        <div class="container">
            <a class="navbar-brand" href="#">Pokémon Explorer</a>
            <div class="ms-auto">
                <input id="pokemon-search" type="search" class="form-control" placeholder="Search Pokémon..." aria-label="Search">
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="pokemon-list">
            <h2 class="mb-3 text-center">Pokémon List</h2>
            <div class="row" id="pokemonGrid">
                <!-- Pokémon cards will be inserted here -->
            </div>
            
            <!-- Loading Spinner -->
            <div id="loadingSpinner" class="text-center d-none">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let offset = 0;
        const limit = 12;
        let isLoading = false; // Biến kiểm tra xem có đang tải dữ liệu hay không

        async function fetchPokemonList() {
            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon?offset=${offset}&limit=${limit}`);
                const data = await response.json();
                return data.results;
            } catch (error) {
                console.error('Error fetching Pokemon list:', error);
                return [];
            }
        }

        async function fetchPokemonDetails(url) {
            try {
                const response = await fetch(url);
                return await response.json();
            } catch (error) {
                console.error('Error fetching Pokemon details:', error);
                return null;
            }
        }

        async function loadPokemonCards() {
            if (isLoading) return;  // Nếu đang tải dữ liệu, không thực hiện lại
            isLoading = true;

            // Hiển thị spinner khi bắt đầu tải dữ liệu
            document.getElementById('loadingSpinner').classList.remove('d-none');

            const pokemonList = await fetchPokemonList();
            const pokemonGrid = document.getElementById('pokemonGrid');

            for (const pokemon of pokemonList) {
                const details = await fetchPokemonDetails(pokemon.url);
                if (details) {
                    const card = document.createElement('div');
                    card.className = 'col-sm-6 col-md-4 col-lg-3 mb-4';
                    card.innerHTML = `
                        <div class="card h-100">
                            <img src="${details.sprites.front_default}" class="card-img-top p-3" alt="${details.name}">
                            <div class="card-body text-center">
                                <h5 class="card-title text-capitalize">${details.name}</h5>
                                <button class="btn btn-primary btn-sm view-details" data-pokemon-id="${details.id}">View Details</button>
                            </div>
                        </div>
                    `;
                    pokemonGrid.appendChild(card);
                }
            }

            offset += limit;

            // Ẩn spinner khi tải xong
            document.getElementById('loadingSpinner').classList.add('d-none');
            isLoading = false;  // Sau khi tải xong, có thể tiếp tục tải dữ liệu
        }

        // Tự động tải thêm Pokémon khi cuộn chuột xuống
        window.addEventListener('scroll', function() {
            const scrollPosition = window.innerHeight + window.scrollY;
            const documentHeight = document.documentElement.scrollHeight;

            // Kiểm tra khi nào người dùng cuộn đến gần đáy trang
            if (scrollPosition >= documentHeight - 200 && !isLoading) {
                loadPokemonCards();
            }
        });

        // Load initial Pokémon cards
        loadPokemonCards();

        // Chỉnh sửa sự kiện khi nhấn nút "View Details"
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('view-details')) {
                const pokemonId = event.target.getAttribute('data-pokemon-id');
                window.location.href = `detail.html?id=${pokemonId}`; // Chuyển đến trang detail.html và truyền ID
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
